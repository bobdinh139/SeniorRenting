<html lang="en" >
<head>

<?php include 'SetUpStudents.php';?>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Rent a senior</title>
 
  <link href="image/wcnr.png" rel="shortcut icon" type="favicon"/>
  <link rel='stylesheet prefetch' href='https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css'>
<link rel='stylesheet prefetch' href='https://cdnjs.cloudflare.com/ajax/libs/typicons/2.0.8/typicons.min.css'>
 <link rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
     <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">


        <link rel="stylesheet" href="css/style.css">

  <link rel='stylesheet prefetch' href='https://cdn.rawgit.com/michalsnik/aos/2.0.4/dist/aos.css'>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

</head>

<body  id="grad">

<style>
#grad {
background: linear-gradient(to bottom, #99f2c8, #1f4037); /* thanks to: https://uigradients.com */

}

</style>
<div  data-aos-duration="2000" data-aos="fade-down">
    <!-- #region Jssor Slider Begin -->
    <!-- Generator: Jssor Slider Maker -->
    <!-- Source: https://www.jssor.com -->
    <script src="js/jssor.slider-27.5.0.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        jssor_1_slider_init = function() {

            var jssor_1_SlideshowTransitions = [
              {$Duration:800,$Opacity:2}
            ];

            var jssor_1_options = {
              $AutoPlay: 1,
              $SlideshowOptions: {
                $Class: $JssorSlideshowRunner$,
                $Transitions: jssor_1_SlideshowTransitions,
                $TransitionsOrder: 1
              },
              $ArrowNavigatorOptions: {
                $Class: $JssorArrowNavigator$
              },
              $BulletNavigatorOptions: {
                $Class: $JssorBulletNavigator$
              }
            };

            var jssor_1_slider = new $JssorSlider$("jssor_1", jssor_1_options);

            /*#region responsive code begin*/

            var MAX_WIDTH = 980;

            function ScaleSlider() {
                var containerElement = jssor_1_slider.$Elmt.parentNode;
                var containerWidth = containerElement.clientWidth;

                if (containerWidth) {

                    var expectedWidth = Math.min(MAX_WIDTH || containerWidth, containerWidth);

                    jssor_1_slider.$ScaleWidth(expectedWidth);
                }
                else {
                    window.setTimeout(ScaleSlider, 30);
                }
            }

            ScaleSlider();

            $Jssor$.$AddEvent(window, "load", ScaleSlider);
            $Jssor$.$AddEvent(window, "resize", ScaleSlider);
            $Jssor$.$AddEvent(window, "orientationchange", ScaleSlider);
            /*#endregion responsive code end*/
        };
    </script>
    <style>
        /*jssor slider loading skin spin css*/
        .jssorl-009-spin img {
            animation-name: jssorl-009-spin;
            animation-duration: 1.6s;
            animation-iteration-count: infinite;
            animation-timing-function: linear;
        }

        @keyframes jssorl-009-spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /*jssor slider bullet skin 051 css*/
        .jssorb051 .i {position:absolute;cursor:pointer;}
        .jssorb051 .i .b {fill:#fff;fill-opacity:0.5;}
        .jssorb051 .i:hover .b {fill-opacity:.7;}
        .jssorb051 .iav .b {fill-opacity: 1;}
        .jssorb051 .i.idn {opacity:.3;}

        /*jssor slider arrow skin 051 css*/
        .jssora051 {display:block;position:absolute;cursor:pointer;}
        .jssora051 .a {fill:none;stroke:#fff;stroke-width:360;stroke-miterlimit:10;}
        .jssora051:hover {opacity:.8;}
        .jssora051.jssora051dn {opacity:.5;}
        .jssora051.jssora051ds {opacity:.3;pointer-events:none;}
    </style>
    <div id="jssor_1" style="position:relative;margin:0 auto;top:0px;left:0px;width:980px;height:380px;overflow:hidden;visibility:hidden;">
        <!-- Loading Screen -->
        <div data-u="loading" class="jssorl-009-spin" style="position:absolute;top:0px;left:0px;width:100%;height:100%;text-align:center;background-color:rgba(0,0,0,0.7);">
            <img style="margin-top:-19px;position:relative;top:50%;width:38px;height:38px;" src="image/spin.svg" />
        </div>
        <div data-u="slides" style="cursor:default;position:relative;top:0px;left:0px;width:980px;height:380px;overflow:hidden;">
            <div>
                <img data-u="image" src="image/001.png" />
            </div>
    <div>
                <img data-u="image" src="image/003.png" />
            </div>
            <div>
                <img data-u="image" src="image/004.png" />
            </div>
            <div>
                <img data-u="image" src="image/005.png" />
            </div>
            <div>
                <img data-u="image" src="image/006.png" />
            </div>
            <div>
                <img data-u="image" src="image/001.png" />
            </div>
            <div>
                <img data-u="image" src="image/001.png" />
            </div>
            <div>
                <img data-u="image" src="image/001.png" />
            </div>
            <div>
                <img data-u="image" src="image/001.png" />
            </div>
            <div>
                <img data-u="image" src="image/001.png" />
            </div>
            <div>
                <img data-u="image" src="image/001.png" />
            </div>
            <div>
                <img data-u="image" src="image/001.png" />
            </div>
            <div>
                <img data-u="image" src="image/001.png" />
            </div>
        </div>
        <!-- Bullet Navigator -->
        <div data-u="navigator" class="jssorb051" style="position:absolute;bottom:12px;right:12px;" data-autocenter="1" data-scale="0.5" data-scale-bottom="0.75">
            <div data-u="prototype" class="i" style="width:16px;height:16px;">
                <svg viewbox="0 0 16000 16000" style="position:absolute;top:0;left:0;width:100%;height:100%;">
                    <circle class="b" cx="8000" cy="8000" r="5800"></circle>
                </svg>
            </div>
        </div>
        <!-- Arrow Navigator -->
        <div data-u="arrowleft" class="jssora051" style="width:55px;height:55px;top:0px;left:25px;" data-autocenter="2" data-scale="0.75" data-scale-left="0.75">
            <svg viewbox="0 0 16000 16000" style="position:absolute;top:0;left:0;width:100%;height:100%;">
                <polyline class="a" points="11040,1920 4960,8000 11040,14080 "></polyline>
            </svg>
        </div>
        <div data-u="arrowright" class="jssora051" style="width:55px;height:55px;top:0px;right:25px;" data-autocenter="2" data-scale="0.75" data-scale-right="0.75">
            <svg viewbox="0 0 16000 16000" style="position:absolute;top:0;left:0;width:100%;height:100%;">
                <polyline class="a" points="4960,1920 11040,8000 4960,14080 "></polyline>
            </svg>
        </div>
    </div>
    <script type="text/javascript">jssor_1_slider_init();</script>
    <!-- #endregion Jssor Slider End -->
 </div>
 </div>
<center><h1>Renting Seniors</h1></center>

<center><info><p style="color:red" id="timer"></p></info></center>

<center><info>
<i>
<p>Please do not spam/use email(s) that is/are not yours</p>
</i>
</info></center>

<section id ="amount">
<?php
	$min_number = 1;
	$max_number = 15;

	$random_number1 = mt_rand($min_number, $max_number);
	$random_number2 = mt_rand($min_number, $max_number);
?>


<?php

use PHPMailer\PHPMailer\PHPMailer;
use PHPMailer\PHPMailer\Exception;
$emailErr = $amountErr = $naErr = $mathErr="";
 $amount = "";

error_reporting(0);
error_reporting(E_ALL & ~E_NOTICE);
 $bad = array("","","","","","","","", "", ""); /*Bad words here */

$captchaResult = $_POST["matha"];
$firstNumber = $_POST["firstNumber"];
$secondNumber = $_POST["secondNumber"];
$checkTotal = $firstNumber + $secondNumber;

function findSenior($str2){
    $str22 = substr($str2, -1,1);
    $str33 = substr($str2, 0,1);
    $txt ="";
    if ($str22 == "m"){
         $str3="allstub.txt";
        $lines = file($str3, FILE_IGNORE_NEW_LINES);
        $txt= $lines[$str33]; 

    }
    elseif ($str22 == "f"){
         $str3="allstug.txt";
        $lines = file($str3, FILE_IGNORE_NEW_LINES);
        $txt= $lines[$str33]; 

    }
    


 return $txt;
    
}

if ($_SERVER["REQUEST_METHOD"] == "POST") {

if (empty($_POST["matha"])){
   
$mathErr = "Math is required";
echo "<script type='text/javascript'>alert('$mathErr');</script>"; 
}else {
    if($captchaResult == $checkTotal){
        
    }
    else {
        $mathErr="Wrong answer"; 
        echo "<script type='text/javascript'>alert('$mathErr');</script>"; 
    }
}


    
}

$checkemail = "@dogrschools.org";
$tocheck = $_POST["email"];
if (isset($_POST["seniorname"])){
    if ($_POST["seniorname"] =="null"){
        $ee ="Cannot choose nobody and then submit!";
        echo "<script type='text/javascript'>alert('$ee');</script>";
        $chekk =-1;
    }
    
if (empty($_POST["email"])) {
    $emailErr = "Email is required";
  
  } else {
 if (!filter_var($_POST["email"], FILTER_VALIDATE_EMAIL)) {
          $emailErr = "Only emails allowed"; 
echo "<script type='text/javascript'>alert('$emailErr');</script>"; 
 
}
elseif(!(strpos( $tocheck, $checkemail)!==false)){
      $emailErr = "Only West emails allowed"; 
echo "<script type='text/javascript'>alert('$emailErr');</script>";
        $chekk =-1;
}


  if (empty($_POST["amount"])) {
    $amountErr = "amount is required";
echo "<script type='text/javascript'>alert('$amountErr');</script>"; 
  } else {

    if (!is_numeric ($_POST["amount"])){
      $amountErr = "Please enter a number";
      echo "<script type='text/javascript'>alert('$amountErr');</script>"; 
      $chekk = -1;
    }
    elseif ($chekk==0)  {
    $amount = test_input($_POST["amount"]);

   }

        
    }

  }
}

if($captchaResult == $checkTotal){
$checc = 0;
if ($amount != ""){

$txt = $amount;
$toapp = "by";

if (empty($_POST["seniorname"])) {
    $emailErr = "empty name";
$checc = -1;  
}

if (empty($_POST["email"])) {
    $emailErr = "empty name";
$checc = -1;  
} else {
     $tempc = strtolower($_POST["email"]);
 foreach ($bad as &$value) {
    if (strpos($tempc, $value) !== false){
      $emailErr = "Bad words are not allowed";
      $checc = -1;
    }
    }
    
    if (!filter_var($_POST["email"], FILTER_VALIDATE_EMAIL)) {
$checc =-1;
 
}

}


if ($checc == -1){
    echo "<script type='text/javascript'>alert('$emailErr');</script>"; 
}
if ($checc == 0){



require $_SERVER['DOCUMENT_ROOT'] . '/mail/Exception.php';
require $_SERVER['DOCUMENT_ROOT'] . '/mail/PHPMailer.php';
require $_SERVER['DOCUMENT_ROOT'] . '/mail/SMTP.php';

$str2=$_POST["seniorname"];
$txt ="";

$txt = findSenior($str2);

$mail = new PHPMailer;
$mail->isSMTP(); 
$mail->SMTPDebug = 0; // 0 = off (for production use) - 1 = client messages - 2 = client and server messages
$mail->Host = "smtp.gmail.com"; // use $mail->Host = gethostbyname('smtp.gmail.com'); // if your network does not support SMTP over IPv6
$mail->Port = 587; // TLS only
$mail->SMTPSecure = 'tls'; // ssl is deprecated
$mail->SMTPAuth = true;
$mail->Username = 'Youremail'; // email
$mail->Password = 'yourpasswd'; // password
$mail->setFrom('your email', 'nullflows smart fridge'); // From email and name
$mail->addAddress($_POST["email"], 'User'); // to email and name
$mail->Subject = 'Verify bidding';
$mail->msgHTML("Did you bid on ".$txt." for $".$amount."?"." Email me if you did/didn't"); //$mail->msgHTML(file_get_contents('contents.html'), __DIR__); //Read an HTML message body from an external file, convert referenced images to embedded,
$mail->AltBody = 'HTML messaging not supported'; // If html emails is not supported by the receiver, show this body
// $mail->addAttachment('images/phpmailer_mini.png'); //Attach an image file
$mess = "";
if(!$mail->send()){
    $mess = "Failed! your email is incorrect? Mailer Error: " . $mail->ErrorInfo;
    $message = $mess;
    echo "<script type='text/javascript'>alert('$message');</script>";
}else{
    $filewbid = fopen("information/amount.txt", "a") or die("Unable to open file!");
$txt = "Amount: $".$amount." for ".$_POST["seniorname"]." ".$toapp." ".$_POST["email"]." ". "at ". date("m/d/Y");
fwrite($filewbid, $txt);
fwrite($filewbid, "\n");

            $str3="information/"."p".$_POST["seniorname"].".txt";
        
         $pre="information/"."pre".$_POST["seniorname"].".txt";
        $listor="information/"."listor".$_POST["seniorname"].".txt";
            $str4 = (int)$_POST["amount"];
        
        $pricefile = fopen($str3, "r") or die("Unable to open file!");
        
         $tocheckbd = (int)fgets($pricefile);
         fclose($pricefile);

         if ($str4 > $tocheckbd ){
            $prefile=fopen($pre, "a") or die("Unable to open file!");
            fwrite($prefile, $_POST["amount"]."\n");
            fclose($prefile);
             $listbfile=fopen($listor, "a") or die("Unable to open file!");
            fwrite($listbfile, $_POST["email"]."\n");
            fclose($listbfile);

         $pricefile=fopen($str3, "w") or die("Unable to open file!");
          fwrite($pricefile, $str4);
            fclose($pricefile);
            $str = "information/".$_POST["seniorname"].".txt";
            $filename = fopen($str, "w") or die("Unable to open file!");
$txt ="";
$str2 = $_POST["seniorname"];

$txt1 = findSenior($str2);
$txt = $txt1.": "."$".$str4;

fwrite($filename, $txt);
fclose($filename);

$txtend = $txt1.": "."$".$str4." by ".$_POST["email"];
$strend = "information/"."end".$_POST["seniorname"].".txt";
$filenameend = fopen($strend, "w") or die("Unable to open file!");
fwrite($filenameend, $txtend);
fclose($filenameend);


    $mess =  "Bidded!";
    $message = $mess.", check your email to verify ";
    echo "<script type='text/javascript'>alert('$message');</script>";
            
  }
         else {
             $AErr = "Your bid is lower than the lastest bid";
             echo "<script type='text/javascript'>alert('$AErr');</script>";
        
         }

}



fclose($filewbid);
} 
}
}
function test_input($data) {
  $data = trim($data);
  $data = stripslashes($data);
  $data = htmlspecialchars($data);
  return $data;
}
?>

<center><info><h3>Bid here</h3></info></center>
<button class="collapsible" data-aos="fade-right"></button>

<div class="content">
<center>

<h4>Buy here</h4>

<form method='post' action="<?php echo htmlspecialchars($_SERVER["PHP_SELF"]);?>">
  Amount:<br>
  <input type="text" name="amount" placeholder="Amount" value="">
  <span class="error"> <?php echo $amountErr;?></span> 
  <br>
  Your senior's name:<br>
  <select name = "seniorname">
  <option value ="null">Nobody</option>
    

  <?php
  $countf = 0;
$fileread = fopen("allstug.txt", "r");
while (!feof($fileread)){
$line = fgets($fileread);
    $countf ++;
}


          $filefdata = fopen("allstug.txt", "r") or die("Unable to open file!");
$i =0;
while(! feof($filefdata))
  {
   
      ?>
            <option value="<?php echo $i."f";?>"><?php echo fgets($filefdata)." (female)";?></option>
        <?php
     $i++;
  }

fclose($filefdata);

?>

    <?php
  $count = 0;
$fileread = fopen("allstub.txt", "r");
while (!feof($fileread)){
$line = fgets($fileread);
    $count ++;
}

          $filefdata = fopen("allstub.txt", "r") or die("Unable to open file!");
$i =0;
while(! feof($filefdata))
  {

      ?>
            <option value="<?php echo $i."m";?>"><?php echo fgets($filefdata)." (male)";?></option>
        <?php
        $i++;
  }

fclose($filefdata);
    
?>


  </select>
  <br>
 Your email:<br>
  <input type="text" name="email" placeholder="Your email" value="<?php echo  $_POST["email"];?>">
  <span class="error"> <?php echo $emailErr;?></span> </input>
  <br><?php echo $random_number1 . ' + ' . $random_number2 . ' = '."?"; ?><br>
  <input name="firstNumber" type="hidden" value="<?php echo $random_number1; ?>" />
  <input name="secondNumber" type="hidden" value="<?php echo $random_number2; ?>" />
  <input type="text" name="matha" placeholder="prove that you are human" value="">
  <span class="error"> <?php echo $mathErr;?></span> </input>
  <br></br>
  <input type="submit" value="BID!">
</form> 
</center>


</div>

</section>
<section id="qaa">
   <center><info><h3>Details about lastest bids</h3></info></center>

<button class="collapsible" data-aos="fade-right"></button>
<div class="content">
<center><h4>Recent Bid + amount</h4></center>

<?php
ini_set( "display_errors", 0); 
$filewbid = fopen("information/amount.txt", "r") or die("Unable to open file!");
while(! feof($filewbid))
  {
  echo fgets($filewbid). "<br />";
  }

fclose($filewbid);
?>
</div>
</section>


<section id="pfep">
  <center><info> <h3>Price for each person</h3></info></center>

<button class="collapsible" data-aos="fade-right"></button>
<div class="content">
<center><h4>Price for each person</h4></center>

<?php
ini_set( "display_errors", 0); 
$countf = 0;
$fileread = fopen("allstug.txt", "r");
while (!feof($fileread)){
$line = fgets($fileread);
    $countf ++;
}
for ($x = 0; $x <= $countf; $x++) {
    $filefdata = fopen("information/".$x."f".".txt", "r") or die("Unable to open file!");
while(! feof($filefdata))
  {
  echo fgets($filefdata). "<br />";
  }

fclose($filefdata);
}

$count = 0;
$fileread = fopen("allstub.txt", "r");
while (!feof($fileread)){
$line = fgets($fileread);
    $count ++;
}

for ($x = 0; $x <= $count; $x++) {
$filemdata = fopen("information/".$x."m".".txt", "r") or die("Unable to open file!");
while(! feof($filemdata))
  {
  echo fgets($filemdata). "<br />";
  }

fclose($filemdata);
}
?>
</div>
</section>

<p></p>

<center> 
<hr>
<p>&nbsp;&nbsp;&nbsp;&nbsp;</p>
<refer><h2>About/Benefits</h2>
<p> Seniors’ secret names are used for anonymity purposes</p>
<p>Update in real-time</p>
<p>Show bidding history, but no names revealed (only bidder's email)</p>
<p>Users can see how much time they have left until the bid expires</p>
<p>User can see who wins which senior</p>
<p>User will receive an email confirmation</p>
<p>Fully Open-source</p>
<p>User can request features, create PR(s) and report issues  <a href="https://github.com/bobdinh139/SeniorRenting"> here</a></p>
<p>Receive updates frequently </p>
</center>
<p>&nbsp;&nbsp;&nbsp;&nbsp;</pp>
<hr>

<center><refer><h2>This website is made possible by:</h2></refer></center>
<center><refer><p> Designing/developing <a href="https://iwillpllugmyself/nullflows"> @nullflows</a></p>
<p>plugin: AOS</p>
<p>Mailing: PHPMailer</p>
<p>Timer support for Safari: momentjs</p>
<p>Slide-Show: Jssor</p>
<p>UIGradient</p>
<p>W3Schools</p>
</refer></center>
<p>&nbsp;&nbsp;&nbsp;&nbsp;</p>
<hr>
<refer>
<cre>
<center>@bobdinh139</center>
</cre>
</refer>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/gsap/1.19.0/TweenMax.min.js'></script>


<script src ='js/javascript.js'></script>

<!–– thanks to https://michalsnik.github.io/aos/  ––>
<script src='https://cdn.rawgit.com/michalsnik/aos/2.0.4/dist/aos.js'></script>
	  <script>AOS.init({
  duration: 1200,
})</script>
